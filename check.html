<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Check</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <nav>
            <a href="index.html">Home</a>
            <a href="check.html">Check</a>
            <a href="about.html">About Us</a>
        </nav>

        <h1>Check Image</h1>
        <p>เลือกรูปภาพเพื่อทำการตรวจสอบ</p>

        <!-- ปุ่มเลือกภาพ -->
        <label for="imageUpload" class="upload-btn">
            เลือกภาพ
        </label>
        <input
            type="file"
            id="imageUpload"
            accept="image/*"
            onchange="loadImage(event)"
            hidden
        >

        <div id="label-container"></div>
    </div>

    <!-- Teachable Machine -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>

    <script>
        const URL = "https://teachablemachine.withgoogle.com/models/_9lW-H6mO/";

        let model;

        // โหลดโมเดลอัตโนมัติ
        window.onload = async function () {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";
            model = await tmImage.load(modelURL, metadataURL);
            console.log("Model loaded");
        };

        // อ่านไฟล์รูป (ไม่แสดงรูป)
        function loadImage(event) {
            const file = event.target.files[0];
            if (!file || !model) return;

            const reader = new FileReader();
            reader.onload = function () {
                const img = new Image();
                img.src = reader.result;
                img.onload = () => predict(img);
            };
            reader.readAsDataURL(file);
        }

        // แสดงเฉพาะคลาสที่มีความน่าจะเป็นสูงสุด
        async function predict(image) {
            const predictions = await model.predict(image);

            let best = predictions[0];
            for (let i = 1; i < predictions.length; i++) {
                if (predictions[i].probability > best.probability) {
                    best = predictions[i];
                }
            }

            document.getElementById("label-container").innerHTML =
                `<strong>ผลลัพธ์:</strong><br>
                 ${best.className}<br>
                 ความน่าจะเป็น: ${(best.probability * 100).toFixed(2)}%`;
        }
    </script>
</body>
</html>
